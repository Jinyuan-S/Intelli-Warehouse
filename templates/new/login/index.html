<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
{#    <link rel="stylesheet" href="index.css">#}
    <link rel="stylesheet" href="{{ url_for('static', filename = 'css/login/index.css') }}">
    <title>登录界面</title>
</head>
<body>
    <div class="container">
        <div class="header">
            <header>仓库监控系统</header>
        </div>
        <div class="content">
            <div>
                <input class="inp" type="text" name="id" id="id" value="" placeholder="账号">
                <br>
                <br>
                <input class="inp" type="password" name="pwd" id="pwd" value="" placeholder="密码">
                <br>
                <br>
                <label for="a" class="forget">忘记密码？</label>
                <br>
                <br>
                <input class="but" type="submit" value="登录">
            </form>
        </div>
    </div>
    <script>
        document.querySelector('.but').onclick= () => {
            let requireData = {
                'type': 'login', 'id':document.querySelector('#id').value, 'pwd': document.querySelector('#pwd').value
            }


            var xhr = new XMLHttpRequest();
            xhr.open("POST", "http://127.0.0.1:5000/user", true);
            xhr.setRequestHeader('content-type', 'application/json');

            //将用户输入值序列化成字符串
            xhr.send(JSON.stringify(requireData));
            xhr.onload = function() {
                if (xhr.status === 200) {
                    console.log(JSON.stringify(requireData))
                    //根据服务器的响应内容格式处理响应结果
                    var res = JSON.parse(xhr.responseText);
                    console.log(xhr.responseText);
                    console.log(res)
                    if (res.status === 0){
                        console.log(res.result[0])
                        localStorage.setItem('workerId', res.result[0])
                        localStorage.setItem('fName', res.result[1])
                        localStorage.setItem('lName', res.result[2])
                        localStorage.setItem('doB', res.result[3])
                        localStorage.setItem('gender', res.result[4])
                        localStorage.setItem('pwd', res.result[5])
                        localStorage.setItem('managerId', res.result[6])
                        location.href = '../records'
                    }else if (body.status === 101) {
                        alert('密码错误')
                    } else if (body.status === 102) {
                        alert('账号不存在')
                    } else {
                        alert('登录失败')
                    }

                }
            }

        }

        document.querySelector('.forget').onclick = () => {
            location.href = '../changePwd'
        }
    </script>
</body>
</html>